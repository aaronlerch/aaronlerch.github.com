<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Aaron Lerch]]></title>
  <link href="http://aaronlerch.github.com/atom.xml" rel="self"/>
  <link href="http://aaronlerch.github.com/"/>
  <updated>2012-01-14T17:05:10-05:00</updated>
  <id>http://aaronlerch.github.com/</id>
  <author>
    <name><![CDATA[Aaron Lerch]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[App Extensibility, Follow Up]]></title>
    <link href="http://aaronlerch.github.com/blog/2011/10/09/app-extensibility/"/>
    <updated>2011-10-09T22:35:00-04:00</updated>
    <id>http://aaronlerch.github.com/blog/2011/10/09/app-extensibility</id>
    <content type="html"><![CDATA[<p>My <a href="http://aaronlerch.github.com/blog/2011/09/08/app-extensibility-in-ruby/">last post</a> about introducing an extensibility point
got some good feedback. I realized two things:</p>

<ol>
<li>Following the pattern of rails generators was <em>huge</em> overkill</li>
<li>I wasn&#8217;t thinking correctly about the problem to begin with</li>
</ol>


<p>Rails generators need to support a lot of things. For example, they
need to process command line arguments, consume or produce templates, and update
existing files in a non-destructive way. The potential complexity in
generators is handled by the complexity in the extensility model
implemented in rails. Arbitrarily duplicating this complexity (magic class names,
inheritance, etc) is just wrong. Which, of course, is why I
said:</p>

<blockquote><p>OK, Iâ€™m doing something wrong, I just know it</p></blockquote>

<p>If I was going to continue down this road (I&#8217;m not, see below) I would
take a cue from something like <a href="http://www.sinatrarb.com/">Sinatra</a> and take advantage
of global methods to reduce/remove requirements on the configuration
code.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">host</span><span class="o">|</span>
</span><span class='line'>  <span class="c1"># do something with &#39;host&#39; to configure your app</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>But that&#8217;s all irrelevent. Jeff Lindsay set me straight in a comment on my
previous post.</p>

<blockquote><p>The hooks that most SCM use, like post-commit or post-receive,
are based on running shell scripts. This is my favorite approach
so far because it&#8217;s not language specific.</p></blockquote>

<p>DUH. I love those things that I look back and think &#8220;of course.&#8221;</p>

<p>I was thinking about this as a ruby problem, because localtunnel&#8217;s
client is written in ruby. But it&#8217;s not a ruby problem. Localtunnel is a
utility. I can write hooks for Git in anything I want, it doesn&#8217;t matter
what language Git is written in. The same is true for localtunnel.</p>

<p>Taking this approach <em>greatly</em> simplifies the solution. And the simpler
solution is always always always the better solution. In this
case, we can add a quick check followed by a system call to enable users
to provide a shell hook to configure whatever system(s) they want:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">SHELL_HOOK_FILE</span> <span class="o">=</span> <span class="s2">&quot;./.localtunnel_callback&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="no">SHELL_HOOK_FILE</span><span class="p">))</span>
</span><span class='line'>  <span class="nb">system</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">SHELL_HOOK_FILE</span><span class="si">}</span><span class="s2"> &quot;&quot;</span><span class="si">#{</span><span class="n">tunnel</span><span class="o">[</span><span class="s1">&#39;host&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span> <span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="no">SHELL_HOOK_FILE</span><span class="p">))</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">!</span><span class="vg">$?</span><span class="o">.</span><span class="n">success?</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;   An error occurred executing the callback hook </span><span class="si">#{</span><span class="no">SHELL_HOOK_FILE</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;   (Make sure it is executable)&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Bam. Localtunnel now provides an extensibility point that can be
implemented in any language. Well, it will when/if my <a href="https://github.com/progrium/localtunnel/pull/27">pull request</a> is
accepted. :)</p>

<p>Thanks, Jeff!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[App Extensibility in Ruby]]></title>
    <link href="http://aaronlerch.github.com/blog/2011/09/08/app-extensibility-in-ruby/"/>
    <updated>2011-09-08T18:13:00-04:00</updated>
    <id>http://aaronlerch.github.com/blog/2011/09/08/app-extensibility-in-ruby</id>
    <content type="html"><![CDATA[<p>I ran into an interesting problem recently. There is a utility
called <a href="http://progrium.com/localtunnel/" title="LocalTunnel is sweet">localtunnel</a> which connects a public URL to a local port. Extremely
useful when it comes to developing an app that leverages services that
expose web hooks.</p>

<p>The problem is that the public URL is only valid while the script is running. Which means every time you start it, you potentially need to go update the web hook URL in whatever service you&#8217;re using. For example, with <a href="http://www.twilio.com/" title="Twilio is awesomesauce">Twilio</a> you configure an app that is available at a particular URL. With GitHub you can add <a href="http://help.github.com/post-receive-hooks/" title="Docs at GitHub">post-receive hooks</a>.</p>

<p>What needs to happen is that localtunnel needs to give you a chance to run some
custom code after it registers and connects up ports, but before it sits
and waits.</p>

<p>It needs an extension point.</p>

<p><a href="https://github.com/snay2/localtunnel/">One fork</a> seeks to do this by having localtunnel call a web hook. It works, even if it feels a bit ironic. ;)
But that involves maintaining another service simply to configure your
first service, which is less than ideal. I took a different approach and I&#8217;d love to get feedback here, since I&#8217;m
still so new to this.</p>

<p>Most stuff on the web about extending ruby has to do with class design,
or monkeypatching, or something else that assumes all the code is
already loaded and executing. In this case, there&#8217;s an existing app (not framework)
and I want to have it load <em>my</em> code dynamically at runtime. In my code,
I want to configure whatever service I need to.</p>

<p>Being a n00b, I&#8217;m not the most widely read yet, so I looked at an
example of something that I already knew exposed an extension point in a
similar way: <a href="http://guides.rubyonrails.org/generators.html">rails generators</a>.</p>

<p><a href="https://github.com/progrium/localtunnel/pull/23">You can see my code here</a>
and the <a href="https://github.com/aaronlerch/localtunnel/">updated readme here</a>,
but here&#8217;s how it works.</p>

<h2>Specify the config to run</h2>

<p>This part was easy, I just extended the existing command line processing
to add a &#8220;-c NAME&#8221; argument specifying which configuration you want to run.
For example:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ localtunnel -c twilio 9292</span></code></pre></td></tr></table></div></figure>


<p>will create a public URL connecting to local port 9292, and will look
for an auto configuration implementation named &#8220;twilio&#8221; and execute it.</p>

<h2>Discovery via magic names, I mean, convention</h2>

<p>This is a nice, but sometimes frustrating thing about Rails. There&#8217;s
lots of stuff that magically happens if you organize or name your code a
certain way.</p>

<p>In this case, to make it easy to specify via the command line, I opted
for a similar &#8220;magic name&#8221; approach. Name your file
foo_auto_config.rb and when you specify &#8220;-c foo&#8221; I&#8217;ll look for your
file under a &#8216;localtunnel&#8217; subdir. This is a way to try and avoid loading a lot of code unnecessarily.</p>

<figure class='code'><figcaption><span>Discover files by name </span><a href='https://github.com/aaronlerch/localtunnel/blob/master/lib/localtunnel/autoconfig.rb'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">lookup</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'>  <span class="n">including_current</span> <span class="o">=</span> <span class="vg">$LOAD_PATH</span><span class="o">.</span><span class="n">dup</span>
</span><span class='line'>  <span class="n">including_current</span> <span class="o">&lt;&lt;</span> <span class="s1">&#39;.&#39;</span>
</span><span class='line'>  <span class="n">including_current</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">base</span><span class="o">|</span>
</span><span class='line'>    <span class="no">Dir</span><span class="o">[</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="s2">&quot;localtunnel&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">_auto_config.rb&quot;</span><span class="p">)</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
</span><span class='line'>      <span class="k">begin</span>
</span><span class='line'>        <span class="nb">require</span> <span class="n">path</span>
</span><span class='line'>      <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
</span><span class='line'>        <span class="nb">puts</span> <span class="s2">&quot;   [Warning] Could not load autoconfig </span><span class="si">#{</span><span class="n">path</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2">. Error: </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">backtrace</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This has a few issues with it. Because this is running as a script, if
you&#8217;re using bundler, the $LOAD_PATH won&#8217;t include all the gems unless
Bundler.require has been called. So looking in the load path for auto
configuration files is probably pointless. Not that gems would include a
custom auto configuration anyway. I should probably remove this.
(Thoughts?) Secondly, I manually added
the local directory because ruby 1.9.2 <a href="http://stackoverflow.com/questions/2900370/why-does-ruby-1-9-2-remove-from-load-path-and-whats-the-alternative">took it out of $LOAD_PATH by default</a> due to security reasons.
And if you consider the use-case, this is typically executed from within
~/MyApp and not randomly throughout the directory structure. Again,
similar to rails generators, you run it from the root of your
application directory.</p>

<h2>Discovery via class name + base class</h2>

<p>Now that we&#8217;ve figured out which files to load, we still don&#8217;t know what
code to call. We need to be able to pass in parameters such as the new
URL that is reserved, so we probably want a method to call and not just loading a file.</p>

<p>Ruby gives us a feature that allows you to know when a new base class is
created: the <a href="http://www.ruby-doc.org/core/classes/Class.html#M000177">inherited</a> method.
It gets called when a new subclass is created.</p>

<p>I created a base class, LocalTunnel::AutoConfig::Base, which keeps track
of all subclasses:</p>

<figure class='code'><figcaption><span>Collect all subclasses into an array </span><a href='https://github.com/aaronlerch/localtunnel/blob/master/lib/localtunnel/autoconfig.rb'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Base</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">inherited</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
</span><span class='line'>    <span class="k">super</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="n">base</span><span class="o">.</span><span class="n">name</span> <span class="o">&amp;&amp;</span> <span class="n">base</span><span class="o">.</span><span class="n">name</span> <span class="o">!~</span> <span class="sr">/Base$/</span>
</span><span class='line'>      <span class="no">LocalTunnel</span><span class="o">::</span><span class="no">AutoConfig</span><span class="o">.</span><span class="n">subclasses</span> <span class="o">&lt;&lt;</span> <span class="n">base</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>When someone specifies &#8220;-c foo&#8221; on the command line, I look for any
subclass of LocalTunnel::AutoConfig::Base that is named FooAutoConfig
and has a method called &#8220;configure&#8221;. If I find that, then that&#8217;s the
auto configuration code that will be called.</p>

<figure class='code'><figcaption><span>Find the right class </span><a href='https://github.com/aaronlerch/localtunnel/blob/master/lib/localtunnel/autoconfig.rb'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">find</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'>  <span class="n">lookup</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">names</span> <span class="o">=</span> <span class="no">Hash</span><span class="o">[</span><span class="n">subclasses</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">klass</span><span class="o">|</span> <span class="o">[</span><span class="n">autoconfig_name</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span><span class="o">.</span><span class="n">downcase</span><span class="p">,</span> <span class="n">klass</span><span class="o">]</span> <span class="p">}</span><span class="o">]</span>
</span><span class='line'>  <span class="n">klass</span> <span class="o">=</span> <span class="n">names</span><span class="o">[</span><span class="nb">name</span><span class="o">]</span>
</span><span class='line'>  <span class="k">return</span> <span class="kp">nil</span> <span class="k">if</span> <span class="n">klass</span><span class="o">.</span><span class="n">nil?</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">configurator</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">configurator</span><span class="o">.</span><span class="n">respond_to?</span> <span class="ss">:configure</span>
</span><span class='line'>    <span class="n">configurator</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="kp">nil</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then I can call that method on an instance of the matching class, and
pass it the new URL.</p>

<figure class='code'><figcaption><span>Call the configuration class </span><a href='https://github.com/aaronlerch/localtunnel/blob/master/lib/localtunnel/tunnel.rb'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">if</span> <span class="o">!</span><span class="vi">@autoconfig</span><span class="o">.</span><span class="n">nil?</span>
</span><span class='line'>  <span class="n">configurator</span> <span class="o">=</span> <span class="no">LocalTunnel</span><span class="o">::</span><span class="no">AutoConfig</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="vi">@autoconfig</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">configurator</span>
</span><span class='line'>    <span class="n">configurator</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">tunnel</span><span class="o">[</span><span class="s1">&#39;host&#39;</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;   [Warning] Unable to find an automatic configuration plugin for &#39;</span><span class="si">#{</span><span class="vi">@autoconfig</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Do your custom configuration</h2>

<p>The configuration code can then run and do whatever it wants. Usually it&#8217;s
specific per app. Here&#8217;s an example of me using this to configure
Twilio.</p>

<figure class='code'><figcaption><span>twilio_auto_config.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;localtunnel/autoconfig&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;twilio-ruby&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;uri&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">TwilioAutoConfig</span> <span class="o">&lt;</span> <span class="no">LocalTunnel</span><span class="o">::</span><span class="no">AutoConfig</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="no">TWILIO_ACCOUNT_SID</span> <span class="o">=</span> <span class="c1"># my account Sid</span>
</span><span class='line'>  <span class="no">TWILIO_AUTH_TOKEN</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_AUTH_TOKEN&#39;</span><span class="o">]</span>
</span><span class='line'>  <span class="no">TWILIO_APP_SID</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;TWILIO_APP_SID&#39;</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
</span><span class='line'>    <span class="c1"># set up a client to talk to the Twilio REST API</span>
</span><span class='line'>    <span class="n">client</span> <span class="o">=</span> <span class="no">Twilio</span><span class="o">::</span><span class="no">REST</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">TWILIO_ACCOUNT_SID</span><span class="p">,</span> <span class="no">TWILIO_AUTH_TOKEN</span><span class="p">)</span>
</span><span class='line'>    <span class="n">app</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">applications</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="no">TWILIO_APP_SID</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Grab the current voice_url and status_callback and swap out the host</span>
</span><span class='line'>    <span class="n">voice</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">voice_url</span><span class="p">)</span>
</span><span class='line'>    <span class="n">voice</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
</span><span class='line'>    <span class="n">status_callback</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">status_callback</span><span class="p">)</span>
</span><span class='line'>    <span class="n">status_callback</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">app</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="ss">:voice_url</span> <span class="o">=&gt;</span> <span class="n">voice</span><span class="o">.</span><span class="n">to_s</span><span class="p">,</span> <span class="ss">:status_callback</span> <span class="o">=&gt;</span> <span class="n">status_callback</span><span class="o">.</span><span class="n">to_s</span><span class="p">})</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;   Configured twilio app </span><span class="si">#{</span><span class="n">app</span><span class="o">.</span><span class="n">friendly_name</span><span class="si">}</span><span class="s2"> for new host </span><span class="si">#{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>OK, I&#8217;m doing something wrong, I just know it</h2>

<p>I am sure I either overcomplicated this, or just plain did it wrong.
Some thoughts I have (in hindsight now) are that perhaps I could&#8217;ve
exposed a global method for the autoconfig code to call. Then, instead
of a base class and magic class name, I&#8217;d just load the specified file
(magic name is still nice) and in that file I could call &#8220;host&#8221; to get
the new host name.</p>

<p>Leave a comment, create a gist, <a href="https://github.com/aaronlerch/localtunnel/">fork my fork</a>,
or <a href="http://twitter.com/aaronlerch/">tweet at me</a>, but somehow let me know how I could
make this better.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[n00b]]></title>
    <link href="http://aaronlerch.github.com/blog/2011/08/25/n00b/"/>
    <updated>2011-08-25T18:17:00-04:00</updated>
    <id>http://aaronlerch.github.com/blog/2011/08/25/n00b</id>
    <content type="html"><![CDATA[<p>It&#8217;s been a long time since I&#8217;ve spent significant time to learn an entirely new technology. And I&#8217;ve had a blast digging into ruby, rails, sinatra, padrino, javascript (okay, I really mean jQuery), and tons of other related frameworks. In spite of some of the excellent, and not-so-excellent, documentation out there, it can be an incredibly frustrating experience. Especially when trying to learn something new &#8211; like something <em>really new</em> &#8211; not just new to me. Expect to see posts here related to what I&#8217;m learning, that make as few assumptions as possible about what you already know.</p>

<p>For example, I recently worked on getting a test environment set up for my app that involves sinatra, mongoid, and twilio APIs. It was an interesting experience. I&#8217;m sure seasoned ruby devs wouldn&#8217;t have had the same issues, but I&#8217;m a firm believer in &#8220;you&#8217;re not alone&#8221; so I&#8217;ll be posting about the process to hopefully help someone else in my shoes.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[New Content, New Blog]]></title>
    <link href="http://aaronlerch.github.com/blog/2011/08/22/new-content/"/>
    <updated>2011-08-22T16:23:00-04:00</updated>
    <id>http://aaronlerch.github.com/blog/2011/08/22/new-content</id>
    <content type="html"><![CDATA[<p>For the past 6 months to a year, I&#8217;ve been getting more and more into
web development on the side (I used to be a web developer, a long time
ago.) I&#8217;ve been focusing exclusively on ruby-based frameworks. It serves
two purposes, I get to learn a new language, and there are plenty of
options out there for me to explore.</p>

<p>In that spirit, instead of changing the focus of my <a href="http://www.aaronlerch.com/blog/">existing
blog</a>, I&#8217;m
going to take a cue from <a href="http://benscheirman.com/blog/2011/08/17/a-fresh-start/">Ben
Scheirman</a> and
start a new blog and just start updating this one more often. Which,
given the number of things going on in my life right now, will not be
often at all. :)</p>

<p>If you haven&#8217;t checked out <a href="http://octopress.org/">octopress</a> you should
- it&#8217;s pretty sweet! I love the idea of a file-based blog engine using
  git.</p>
]]></content>
  </entry>
  
</feed>
